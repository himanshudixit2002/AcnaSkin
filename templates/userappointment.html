<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}My Flask App{% endblock %}</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            overflow-x: hidden;
        }
    </style>
</head>
<body>

    <nav class="h-[10vh] shadow-md flex p-2 px-6 justify-between items-center">
        <div class="text-xl font-semibold text-rose-500">Skintellect</div>
        <ul class="flex items-center gap-8">
            <a href="{{url_for('predict')}}">Face Analysis</a>
            <a href="{{url_for('bookappointment')}}">Book Appointment</a>
            <a href="{{url_for('userappoint')}}">Appointments</a>
            <a href="{{url_for('profile')}}">Profile</a>
            <a href="{{url_for('logout')}}">Logout</a>
        </ul>
    </nav>

    <div class="h-[100vh] w-full relative flex flex-col items-center justify-center">
        <img src="../static/assets/bg.webp" alt="" class="absolute top-0 left-0 w-full h-full object-cover brightness-[90%] z-0">
        
        <div class="h-[70vh] w-4/5 bg-white bg-opacity-80 rounded-xl p-8 backdrop-blur-md z-20 shadow-xl">
            <h1 class="text-black text-5xl font-serif text-center mb-6">
                <i class="fa-solid fa-calendar-check text-6xl text-black"></i> Doctor's Appointments
            </h1>
            <div id="appointmentsContainer" class="h-[60vh] w-full overflow-y-scroll p-4 rounded-lg bg-gray-100 shadow-md"></div>
        </div>
    </div>

    <script>
        var appointments = {{ all_appointments | safe }};
        var container = document.getElementById("appointmentsContainer");

        appointments.forEach(function(appointment) {
            var appointmentDiv = document.createElement("div");
            appointmentDiv.classList.add("h-auto", "w-full", "bg-white", "p-4", "rounded-lg", "shadow-sm", "border-l-4", "border-gray-300", "mb-4", "relative");
            
            var status = appointment[8] == 0 ? "Pending" : "Accepted";
            var content = `
                <strong>Name:</strong> ${appointment[1]}<br>
                <strong>Email:</strong> ${appointment[2]}<br>
                <strong>Date:</strong> ${appointment[3]}<br>
                <strong>Skin type:</strong> ${appointment[4]}<br>
                <strong>Status:</strong> ${status}<br>
            `;
            
            var deleteIcon = document.createElement("i");
            deleteIcon.classList.add("fas", "fa-trash-alt", "cursor-pointer", "text-red-500", "absolute", "top-2", "right-4");
            deleteIcon.onclick = function() {
                handleDelete(appointment);
            };
            
            appointmentDiv.innerHTML = content;
            appointmentDiv.appendChild(deleteIcon);
            container.appendChild(appointmentDiv);
        });
        
        function handleDelete(appointment) {
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "/delete_user_request", true);
            xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    console.log("Deleted successfully");
                    window.location.reload();
                }
            };
            xhr.send("id=" + appointment[0]);
        }
    </script>
    
</body>
</html>