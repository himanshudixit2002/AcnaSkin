{% extends 'layout.html' %}

{% block content %}
<div class="h-[100vh] w-full relative flex flex-col items-center justify-center">
    <div class="h-[70vh] w-full flex flex-col justify-center items-center gap-9 z-20">
        <div class="h-[10vh] w-full flex items-center justify-center">
            <h1 class="text-black text-6xl font-serif">
                <i class="fa-solid fa-calendar-check text-7xl text-black"></i> 
                Doctor's Appointments
            </h1>
        </div>
        <div id="appointmentsContainer" class="h-[80vh] w-4/5 bg-white bg-opacity-80 p-8 backdrop-blur-md rounded-xl overflow-y-scroll shadow-2xl shadow-black flex flex-col">
            <!-- Appointments will be inserted here by JavaScript -->
        </div>
    </div>
</div>

<script>
   
    var appointments = JSON.parse('{{ all_appointments | tojson | safe }}') || [];
    console.log("Appointments:", appointments);

    var container = document.getElementById("appointmentsContainer");

 e
    if (appointments.length === 0) {
        container.innerHTML = "<p class='text-center text-gray-500 text-xl'>No appointments found.</p>";
    } else {
        appointments.forEach(function(appointment) {
            var appointmentDiv = document.createElement("div");
            appointmentDiv.classList.add("h-auto", "w-full", "bg-slate-300", "mt-3", "rounded-xl", "border-black", "border-2", "p-3", "text-2xl", "font-serif", "relative");

            var status = appointment.status == 0 ? "Pending" : "Accepted"; 

            var content = "<strong>Name:</strong> " + appointment.name + "<br>" +
                        "<strong>Email:</strong> " + appointment.email + "<br>" +
                        "<strong>Date:</strong> " + appointment.date + "<br>" +
                        "<strong>Skin Type:</strong> " + appointment.skin + "<br>" +
                        "<strong>Status:</strong> <span class='" + (status === "Pending" ? "text-red-500" : "text-green-500") + "'>" + status + "</span><br>";

            var deleteIcon = document.createElement("i");
            deleteIcon.classList.add("fas", "fa-trash-alt", "cursor-pointer", "text-red-500", "ml-2", "absolute", "top-4", "right-4", "hover:text-red-700", "transition-all");
            deleteIcon.setAttribute("aria-hidden", "true");

            deleteIcon.addEventListener("click", function() {
                handleDelete(appointment);
            });

            appointmentDiv.innerHTML = content;
            appointmentDiv.appendChild(deleteIcon);
            container.appendChild(appointmentDiv);
        });
    }


    function handleDelete(appointment) {
        if (!confirm("Are you sure you want to delete this appointment?")) return;

        var xhr = new XMLHttpRequest();
        xhr.open("POST", "/delete_user_request", true);
        xhr.setRequestHeader("Content-Type", "application/json"); 
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
                console.log("Deleted successfully");
                window.location.reload();
            }
        };
        xhr.send(JSON.stringify({ id: appointment.id })); 
    }
</script>
{% endblock %}
