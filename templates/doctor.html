{% extends 'layout.html' %}

{% block content %}
<div class="min-h-screen w-screen flex items-center justify-center pt-20">
    <div class="w-4/5 bg-white bg-opacity-90 rounded-xl p-8 backdrop-blur-md shadow-lg">
        <h1 class="text-3xl font-bold text-gray-800 text-center mb-6">
            <i class="fa-solid fa-stethoscope"></i> Doctor's Appointments
        </h1>
        <div id="appointmentsContainer" class="overflow-y-scroll h-[60vh] p-4 bg-gray-100 rounded-md"></div>
    </div>
</div>

<script>
    const appointments = JSON.parse('{{ appointments | tojson | safe }}');
    const container = document.getElementById("appointmentsContainer");

    async function updateStatus(appointmentId, action) {
        if (!confirm(`Are you sure you want to ${action} this appointment?`)) return;
        try {
            const response = await fetch(`/appointment/${appointmentId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ status: action === 'approve' ? 1 : 2 })
            });

            if (response.ok) {
                location.reload(); // Refresh to show updated list
            } else {
                alert('Failed to update status');
            }
        } catch (error) {
            console.error('Error:', error);
        }
    }

    if (appointments.length === 0) {
        container.innerHTML = `<p class="text-gray-500 text-center">No appointments available.</p>`;
    } else {
        appointments.forEach(function(appointment) {
            var appointmentDiv = document.createElement("div");
            appointmentDiv.classList.add("p-4", "bg-white", "rounded-lg", "shadow-md", "mb-4");

            var content = `
                <strong>Name:</strong> ${appointment[1]}<br>
                <strong>Email:</strong> ${appointment[2]}<br>
                <strong>Date:</strong> ${appointment[3]}<br>
                <strong>Skin Type:</strong> ${appointment[4]}<br>
                <div class="mt-3 flex gap-2">
                    <button onclick="updateStatus(${appointment.id}, 'approve')"
                        class="px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600">
                        Approve
                    </button>
                    <button onclick="updateStatus(${appointment.id}, 'reject')"
                        class="px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600">
                        Reject
                    </button>
                </div>
            `;

            appointmentDiv.innerHTML = content;
            container.appendChild(appointmentDiv);
        });
    }
</script>

{% endblock %}
