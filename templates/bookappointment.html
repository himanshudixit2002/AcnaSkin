{% extends 'layout.html' %}

{% block content %}
<style>
  /* Container for the appointments page */
  .appointment-container {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 1rem;
  }
  /* Appointment card styling */
  .appointment-card {
      margin-bottom: 1.5rem;
      border-radius: 0.75rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  .appointment-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
  }
  .appointment-header {
      background-color: #007BFF;
      color: #fff;
      padding: 1rem;
      border-top-left-radius: 0.75rem;
      border-top-right-radius: 0.75rem;
  }
  .appointment-body {
      padding: 1rem;
  }
  .delete-btn {
      cursor: pointer;
  }
  /* Responsive adjustments */
  @media (max-width: 768px) {
      .appointment-card {
          margin-bottom: 1rem;
      }
  }
</style>

<div class="appointment-container">
  <h1 class="text-center mb-4" style="color: #007BFF;">My Appointments</h1>
  <div class="row" id="appointmentsRow">
    {% if all_appointments %}
      {% for appointment in all_appointments %}
        <div class="col-md-6">
          <div class="card appointment-card">
            <div class="appointment-header d-flex justify-content-between align-items-center">
              <div>
                <h5 class="mb-0">{{ appointment[1] }}</h5>
              </div>
              <div>
                {% if appointment[8] == 1 %}
                  <span class="badge bg-success">Accepted</span>
                {% else %}
                  <span class="badge bg-warning text-dark">Pending</span>
                {% endif %}
              </div>
            </div>
            <div class="appointment-body">
              <p class="mb-1"><strong>Email:</strong> {{ appointment[2] }}</p>
              <p class="mb-1"><strong>Date:</strong> {{ appointment[3] }}</p>
              <p class="mb-1"><strong>Skin Type:</strong> {{ appointment[4] }}</p>
              <p class="mb-1"><strong>Phone:</strong> {{ appointment[5] }}</p>
              <button class="btn btn-sm btn-danger delete-btn" data-id="{{ appointment[0] }}">
                <i class="fas fa-trash-alt"></i> Delete
              </button>
            </div>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <div class="col-12">
        <p class="text-center">No appointments found.</p>
      </div>
    {% endif %}
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const deleteButtons = document.querySelectorAll('.delete-btn');
  
  deleteButtons.forEach(button => {
    button.addEventListener('click', function() {
      const appointmentId = this.getAttribute('data-id');
      if (confirm("Are you sure you want to delete this appointment?")) {
        fetch('/delete_user_request', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
          },
          body: 'id=' + encodeURIComponent(appointmentId)
        })
        .then(response => {
          if (response.ok) {
            location.reload();
          } else {
            alert("Failed to delete appointment. Please try again.");
          }
        })
        .catch(error => {
          console.error("Error deleting appointment:", error);
          alert("An error occurred. Please try again.");
        });
      }
    });
  });
});
</script>
{% endblock %}
